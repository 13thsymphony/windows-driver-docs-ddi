---
UID: NF.winddiui.DrvDocumentEvent
title: DrvDocumentEvent
author: windows-driver-content
description: A printer interface DLL's DrvDocumentEvent function can handle certain events associated with printing a document.
old-location: print\drvdocumentevent.htm
ms.assetid: 09229774-14db-448b-bd49-2d39a848c9a6
ms.author: windowsdriverdev
ms.date: 10/24/2017
ms.topic: function
ms.prod: windows-hardware
ms.technology: print
req.header: winddiui.h
req.include-header: Winddiui.h
req.target-type: Desktop
req.target-min-winverclnt: 
req.target-min-winversvr: 
req.kmdf-ver: 
req.umdf-ver: 
req.alt-api: DrvDocumentEvent
req.alt-loc: winddiui.h
req.ddi-compliance: 
req.unicode-ansi: 
req.idl: 
req.max-support: 
req.namespace: 
req.assembly: 
req.type-library: 
req.lib: 
req.dll: 
req.irql: 
ms.keywords: DrvDocumentEvent
req.iface: 
req.product: Windows 10 or later.
---

# DrvDocumentEvent function



## -description
<p>A printer interface DLL's <b>DrvDocumentEvent</b> function can handle certain events associated with printing a document.</p>


## -syntax

````
int DrvDocumentEvent(
        HANDLE hPrinter,
        HDC    hdc,
        int    iEsc,
        ULONG  cbIn,
  _In_  PVOID  pvIn,
        ULONG  cbOut,
  _Out_ PVOID  pvOut
);
````


## -parameters
<dl>

### -param <i>hPrinter</i> 

<dd>
<p>Caller-supplied printer handle.</p>
</dd>

### -param <i>hdc</i> 

<dd>
<p>Caller-supplied device context handle, generated by a <b>CreateDC</b> (described in the Windows SDK documentation) call. This is zero if <i>iEsc</i> is set to DOCUMENTEVENT_CREATEDCPRE. For restrictions on printing from a 32-bit application on a 64-bit version of Windows, see the following Remarks section.</p>
</dd>

### -param <i>iEsc</i> 

<dd>
<p>Caller-supplied escape code identifying the event to be handled. This parameter can be one of the following integer constants. See the Windows SDK documentation for descriptions of the functions listed in the Event column.</p>
<p>For restrictions on printing from a 32-bit application on a 64-bit version of Windows, see the following Remarks section.</p>
<table>
<tr>
<th><b>iEsc</b> Constant</th>
<th>Event</th>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ABORTDOC</p>
</td>
<td>
<p>GDI is about to process a call to its <b>AbortDoc</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_CREATEDCPOST</p>
</td>
<td>
<p>GDI has just processed a call to its <b>CreateDC</b> or <b>CreateIC</b> function.</p>
<p>This escape code should not be used unless there has been a previous call to <b>DrvDocumentEvent</b> with <i>iEsc</i> set to DOCUMENTEVENT_CREATEDCPRE.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_CREATEDCPRE</p>
</td>
<td>
<p>GDI is about to process a call to its <b>CreateDC</b> or <b>CreateIC</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_DELETEDC</p>
</td>
<td>
<p>GDI is about to process a call to its <b>DeleteDC</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ENDDOCPOST</p>
</td>
<td>
<p>GDI has just processed a call to its <b>EndDoc</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ENDDOCPRE </p>
<p>or</p>
<p>DOCUMENTEVENT_ENDDOC</p>
</td>
<td>
<p>GDI is about to process a call to its <b>EndDoc</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ENDPAGE</p>
</td>
<td>
<p>GDI is about to process a call to its <b>EndPage</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ESCAPE</p>
</td>
<td>
<p>GDI is about to process a call to its <b>ExtEscape</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_QUERYFILTER</p>
</td>
<td>
<p>The DOCUMENTEVENT_QUERYFILTER event represents an opportunity for the spooler to query the driver for a list of the DOCUMENTEVENT_<i>XXX</i> events to which the driver will respond. This event is issued just prior to a call to <b>DrvDocumentEvent</b> that passes the DOCUMENTEVENT_CREATEDCPRE event.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_RESETDCPOST</p>
</td>
<td>
<p>GDI has just processed a call to its <b>ResetDC</b> function.</p>
<p>This escape code should not be used unless there has been a previous call to <b>DrvDocumentEvent</b> with <i>iEsc</i> set to DOCUMENTEVENT_RESETDCPRE.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_RESETDCPRE</p>
</td>
<td>
<p>GDI is about to process a call to its <b>ResetDC</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_STARTDOCPOST</p>
</td>
<td>
<p>GDI has just processed a call to its <b>StartDoc</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_STARTDOCPRE </p>
<p>or</p>
<p>DOCUMENTEVENT_STARTDOC</p>
</td>
<td>
<p>GDI is about to process a call to its <b>StartDoc</b> function.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_STARTPAGE</p>
</td>
<td>
<p>GDI is about to process a call to its <b>StartPage</b> function.</p>
</td>
</tr>
</table>
<p> </p>
</dd>

### -param <i>cbIn</i> 

<dd>
<p>Caller-supplied size, in bytes, of the buffer pointed to by <i>pvIn</i>.</p>
</dd>

### -param <i>pvIn</i> [in]

<dd>
<p>Caller-supplied pointer, the use of which is dependent on the value supplied for <i>iEsc</i>, as follows:</p>
<table>
<tr>
<th><i>iEsc</i> Constant</th>
<th><i>pvIn</i> Contents</th>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ABORTDOC</p>
</td>
<td>
<p>Not used.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_CREATEDCPOST</p>
</td>
<td>
<p><i>pvIn</i> contains the address of a pointer to the <a href="https://msdn.microsoft.com/library/windows/hardware/ff552837">DEVMODEW</a> structure specified in the <i>pvOut</i> parameter in a previous call to this function, for which the <i>iEsc</i> parameter was set to DOCUMENTEVENT_CREATEDCPRE.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_CREATEDCPRE</p>
</td>
<td>
<p><i>pvIn </i>points to a <a href="https://msdn.microsoft.com/library/windows/hardware/ff547612">DOCEVENT_CREATEDCPRE</a> structure.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_DELETEDC</p>
</td>
<td>
<p>Not used.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ENDDOCPOST</p>
</td>
<td>
<p>Not used.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ENDDOCPRE </p>
<p>or</p>
<p>DOCUMENTEVENT_ENDDOC</p>
</td>
<td>
<p>Not used.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ENDPAGE</p>
</td>
<td>
<p>Not used.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ESCAPE</p>
</td>
<td>
<p><i>pvIn</i> points to a <a href="https://msdn.microsoft.com/library/windows/hardware/ff548377">DOCEVENT_ESCAPE</a> structure.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_QUERYFILTER</p>
</td>
<td>
<p>Same as for DOCUMENTEVENT_CREATEDCPRE.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_RESETDCPOST</p>
</td>
<td>
<p><i>pvIn</i> contains the address of a pointer to the <a href="https://msdn.microsoft.com/library/windows/hardware/ff552837">DEVMODEW</a> structure specified in the <i>pvOut</i> parameter in a previous call to this function, for which the <i>iEsc</i> parameter was set to DOCUMENTEVENT_RESETDCPRE.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_RESETDCPRE</p>
</td>
<td>
<p><i>pvIn</i> contains the address of a pointer to the <a href="https://msdn.microsoft.com/library/windows/hardware/ff552837">DEVMODEW</a> structure supplied by the caller of <b>ResetDC</b> (described in the Windows SDK documentation).</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_STARTDOCPOST</p>
</td>
<td>
<p><i>pvIn</i> points to a LONG that specifies the print job identifier returned by <b>StartDoc</b> (described in the Windows SDK documentation).</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_STARTDOCPRE </p>
<p>or</p>
<p>DOCUMENTEVENT_STARTDOC</p>
</td>
<td>
<p><i>pvIn</i> contains the address of a pointer to a DOCINFO structure supplied by the caller of <b>StartDoc</b> (both described in the Windows SDK documentation). </p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_STARTPAGE</p>
</td>
<td>
<p>Not used.</p>
</td>
</tr>
</table>
<p> </p>
</dd>

### -param <i>cbOut</i> 

<dd>
<p></p>
<dl>

### -param <a id="If_iEsc_is_DOCUMENTEVENT_ESCAPE_"></a><a id="if_iesc_is_documentevent_escape_"></a><a id="IF_IESC_IS_DOCUMENTEVENT_ESCAPE_"></a>If <i>iEsc</i> is DOCUMENTEVENT_ESCAPE:

<dd>
<p>Function-supplied value that is used as the <i>cbOutput</i> parameter for <b>ExtEscape</b>.</p>
</dd>

### -param <a id="If_iEsc_is_DOCUMENTEVENT_QUERYFILTER_"></a><a id="if_iesc_is_documentevent_queryfilter_"></a><a id="IF_IESC_IS_DOCUMENTEVENT_QUERYFILTER_"></a>If <i>iEsc</i> is DOCUMENTEVENT_QUERYFILTER:

<dd>
<p>Caller-supplied size, in bytes, of the buffer pointer to by <i>pvOut</i>.</p>
</dd>

### -param <a id="For_all_other_iEsc_values_"></a><a id="for_all_other_iesc_values_"></a><a id="FOR_ALL_OTHER_IESC_VALUES_"></a>For all other <i>iEsc</i> values:

<dd>
<p>Not used.</p>
</dd>
</dl>
</dd>

### -param <i>pvOut</i> [out]

<dd>
<p>Function-supplied pointer to an output buffer, the use of which is dependent on the value supplied for <i>iEsc</i>, as follows. <b>CreateDC</b>, <b>ExtEscape</b>, and <b>ResetDC</b> are described in the Windows SDK documentation.</p>
<table>
<tr>
<th><i>iEsc</i> Constant</th>
<th><i>pvOut</i> Contents</th>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_CREATEDCPRE</p>
</td>
<td>
<p>Pointer to a driver-supplied DEVMODEW structure, which GDI uses instead of the one supplied by the <b>CreateDC</b> caller. (If <b>NULL</b>, GDI uses the caller-supplied structure.)</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_ESCAPE</p>
</td>
<td>
<p>Buffer pointer that is used as the <i>lpszOutData</i> parameter for <b>ExtEscape</b>.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_QUERYFILTER</p>
</td>
<td>
<p>Caller-supplied pointer to buffer containing a <a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a> structure.</p>
</td>
</tr>
<tr>
<td>
<p>DOCUMENTEVENT_RESETDCPRE</p>
</td>
<td>
<p>Pointer to a driver-supplied DEVMODEW structure, which GDI uses instead of the one supplied by the <b>ResetDC</b> caller. (If <b>NULL</b>, GDI uses the caller-supplied structure.)</p>
</td>
</tr>
<tr>
<td>
<p>All other <i>iEsc</i> values</p>
</td>
<td>
<p>Not used.</p>
</td>
</tr>
</table>
<p> </p>
</dd>
</dl>

## -returns
<p>The function's return value is dependent on the escape supplied for <i>iEsc</i>. For some escape codes, the return value is not used (see the second list of values). If the function supplies a return value, it must be one of the following:</p><dl>
<dt><b>DOCUMENTEVENT_FAILURE</b></dt>
</dl><p>The driver supports the escape code identified by <i>iEsc</i>, but a failure occurred.</p><dl>
<dt><b>DOCUMENTEVENT_SUCCESS</b></dt>
</dl><p>The driver successfully handled the escape code identified by <i>iEsc</i>.</p><dl>
<dt><b>DOCUMENTEVENT_UNSUPPORTED</b></dt>
</dl><p>The driver does not support the escape code identified by <i>iEsc</i>.</p>

<p> </p>

## -remarks
<p>A <a href="NULL">printer interface DLL</a> can optionally provide a <b>DrvDocumentEvent</b> function to perform preprocessing or postprocessing of GDI calls associated with rendering a document. Calls to the <b>DrvDocumentEvent</b> function are made from the user-mode GDI client, when an application makes calls into the GDI client.</p>

<p>For an <i>iEsc</i> value of DOCUMENTEVENT_QUERYFILTER, the spooler can interpret a DOCUMENTEVENT_SUCCESS value returned by <b>DrvDocumentEvent</b> in two ways, depending on whether the driver modified certain members of the <a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a> structure. (The <i>pvOut</i> parameter points to this structure.) When the spooler allocates memory for a structure of this type, it initializes two members of this structure, <b>cElementsReturned</b> and <b>cElementsNeeded</b>, to known values. After <b>DrvDocumentEvent</b> returns, the spooler determines whether the values of these members have changed, and uses that information to interpret the <b>DrvDocumentEvent</b> return value. The following table summarizes this situation.</p>

<p>DOCUMENTEVENT_SUCCESS</p>

<p>Driver made no change to either member.</p>

<p>The spooler interprets this return value as equivalent to DOCUMENTEVENT_UNSUPPORTED.</p>

<p>The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.</p>

<p>DOCUMENTEVENT_SUCCESS</p>

<p>Driver wrote to one or both members.</p>

<p>The spooler accepts this return value without interpretation. If the driver wrote to only one of <b>cElementsNeeded</b> and <b>cElementsReturned</b>, the spooler considers the unchanged member to have a value of zero.</p>

<p>The spooler filters out all events listed in the <b>aDocEventCall</b> member of <a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a>.</p>

<p>DOCUMENTEVENT_UNSUPPORTED</p>

<p>Not applicable</p>

<p>The driver does not support DOCUMENTEVENT_QUERYFILTER.</p>

<p>The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.</p>

<p>DOCUMENTEVENT_FAILURE</p>

<p>Not applicable</p>

<p>The driver supports DOCUMENTEVENT_QUERYFILTER, but encountered an internal error.</p>

<p>The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.</p>

<p> </p>

<p>If the escape code name has no suffix or is suffixed with PRE, the GDI client calls <b>DrvDocumentEvent</b> just prior to calling the kernel-mode GDI rendering engine. If the escape code name is suffixed with POST, the GDI client calls <b>DrvDocumentEvent</b> just after the kernel-mode GDI rendering engine returns.</p>

<p>If the escape code supplied in the <i>iEsc</i> parameter is DOCUMENTEVENT_CREATEDCPRE, the following rules apply:</p>

<p>If the job is being sent directly to the printer without spooling, <i>pvIn</i> --&gt; pszDevice points to the printer name. (See the <a href="https://msdn.microsoft.com/library/windows/hardware/ff547612">DOCEVENT_CREATEDCPRE</a> structure for more information.)</p>

<p>If the job is being spooled, <i>pvIn</i> --&gt; pszDevice points to the printer port name.</p>

<p>The <b>DrvDocumentEvent</b> function executes in the context of the user-mode caller of the GDI client function. When EMF spooling is disabled, the function can display a user interface. For example, the <b>DrvDocumentEvent</b> function for a FAX driver might display a dialog box to the user before GDI's <b>StartDoc</b> function (described in the Microsoft Windows SDK documentation) is processed.</p>

<p>A <a href="NULL">printer interface DLL</a> can optionally provide a <b>DrvDocumentEvent</b> function to perform preprocessing or postprocessing of GDI calls associated with rendering a document. Calls to the <b>DrvDocumentEvent</b> function are made from the user-mode GDI client, when an application makes calls into the GDI client.</p>

<p>For an <i>iEsc</i> value of DOCUMENTEVENT_QUERYFILTER, the spooler can interpret a DOCUMENTEVENT_SUCCESS value returned by <b>DrvDocumentEvent</b> in two ways, depending on whether the driver modified certain members of the <a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a> structure. (The <i>pvOut</i> parameter points to this structure.) When the spooler allocates memory for a structure of this type, it initializes two members of this structure, <b>cElementsReturned</b> and <b>cElementsNeeded</b>, to known values. After <b>DrvDocumentEvent</b> returns, the spooler determines whether the values of these members have changed, and uses that information to interpret the <b>DrvDocumentEvent</b> return value. The following table summarizes this situation.</p>

<p>DOCUMENTEVENT_SUCCESS</p>

<p>Driver made no change to either member.</p>

<p>The spooler interprets this return value as equivalent to DOCUMENTEVENT_UNSUPPORTED.</p>

<p>The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.</p>

<p>DOCUMENTEVENT_SUCCESS</p>

<p>Driver wrote to one or both members.</p>

<p>The spooler accepts this return value without interpretation. If the driver wrote to only one of <b>cElementsNeeded</b> and <b>cElementsReturned</b>, the spooler considers the unchanged member to have a value of zero.</p>

<p>The spooler filters out all events listed in the <b>aDocEventCall</b> member of <a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a>.</p>

<p>DOCUMENTEVENT_UNSUPPORTED</p>

<p>Not applicable</p>

<p>The driver does not support DOCUMENTEVENT_QUERYFILTER.</p>

<p>The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.</p>

<p>DOCUMENTEVENT_FAILURE</p>

<p>Not applicable</p>

<p>The driver supports DOCUMENTEVENT_QUERYFILTER, but encountered an internal error.</p>

<p>The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.</p>

<p> </p>

<p>If the escape code name has no suffix or is suffixed with PRE, the GDI client calls <b>DrvDocumentEvent</b> just prior to calling the kernel-mode GDI rendering engine. If the escape code name is suffixed with POST, the GDI client calls <b>DrvDocumentEvent</b> just after the kernel-mode GDI rendering engine returns.</p>

<p>If the escape code supplied in the <i>iEsc</i> parameter is DOCUMENTEVENT_CREATEDCPRE, the following rules apply:</p>

<p>If the job is being sent directly to the printer without spooling, <i>pvIn</i> --&gt; pszDevice points to the printer name. (See the <a href="https://msdn.microsoft.com/library/windows/hardware/ff547612">DOCEVENT_CREATEDCPRE</a> structure for more information.)</p>

<p>If the job is being spooled, <i>pvIn</i> --&gt; pszDevice points to the printer port name.</p>

<p>The <b>DrvDocumentEvent</b> function executes in the context of the user-mode caller of the GDI client function. When EMF spooling is disabled, the function can display a user interface. For example, the <b>DrvDocumentEvent</b> function for a FAX driver might display a dialog box to the user before GDI's <b>StartDoc</b> function (described in the Microsoft Windows SDK documentation) is processed.</p>

## -requirements
<table>
<tr>
<th width="30%">
<p>Target platform</p>
</th>
<td width="70%">
<dl>
<dt>Desktop</dt>
</dl>
</td>
</tr>
<tr>
<th width="30%">
<p>Header</p>
</th>
<td width="70%">
<dl>
<dt>Winddiui.h (include Winddiui.h)</dt>
</dl>
</td>
</tr>
</table>

## -see-also
<dl>
<dt>
<a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a>
</dt>
<dt>
<a href="https://msdn.microsoft.com/library/windows/hardware/ff547612">DOCEVENT_CREATEDCPRE</a>
</dt>
<dt>
<a href="https://msdn.microsoft.com/library/windows/hardware/ff548377">DOCEVENT_ESCAPE</a>
</dt>
</dl>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [print\print]:%20DrvDocumentEvent function%20 RELEASE:%20(10/24/2017)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
