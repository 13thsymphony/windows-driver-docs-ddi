---
UID: NF.ks.KsAcquireCachedMdl
title: KsAcquireCachedMdl function
author: windows-driver-content
description: This function is used to acquire the MDL cached by the KS port driver. The function is used by a kernel mode driver to acquire the MDL for a pipeline-supplied sample generated by an Avstream driver.
old-location: stream\ksacquirecachedmdl.htm
old-project: stream
ms.assetid: C6C693CC-D9C0-4EE8-9F8C-07D8665C673D
ms.author: windowsdriverdev
ms.date: 12/6/2017
ms.keywords: KsAcquireCachedMdl
ms.prod: windows-hardware
ms.technology: windows-devices
ms.topic: function
req.header: ks.h
req.include-header: 
req.target-type: Universal
req.target-min-winverclnt: 
req.target-min-winversvr: 
req.kmdf-ver: 
req.umdf-ver: 
req.alt-api: KsAcquireCachedMdl
req.alt-loc: ks.lib,ks.dll
req.ddi-compliance: 
req.unicode-ansi: 
req.idl: 
req.max-support: 
req.namespace: 
req.assembly: 
req.type-library: 
req.lib: Ks.lib
req.dll: 
req.irql: 
---

# KsAcquireCachedMdl function



## -description
This function is used to acquire the MDL cached by the KS port driver. The function is used by a kernel mode driver to acquire the MDL for a pipeline-supplied sample generated by an Avstream driver.


## -syntax

````
void _Must_inspect_result_ _IRQL_requires_max_(PASSIVE_LEVEL) KSDDKAPI NTSTATUS WINAPI KsAcquireCachedMdl(
   _In_                      PIRP                 Irp,
   _In_                      REFGUID              Guid,
   _In_                      PFNKSCANCELPINNEDMDL CancelRoutine,
   _In_                      PVOID                CancelContext,
   _Outptr_result_maybenull_ PMDL                 *MdlAddr,
   _Outptr_result_maybenull_ PVOID*               ReleaseContext
);
````


## -parameters

### -param Irp 

The IRP passed from the user mode containing the user-mode sample buffer.

### -param Guid 

The GUID extracted from the <b>MFSampleExtension_MDLCacheCookie</b> attribute item of the <b>IMFSample</b> passed by the pipeline.

### -param CancelRoutine 

Cancel routine, a callback function supplied by the Avstream miniport driver. This function is called when the state of the pin generating the sample is going to STOP state.  The signature of the cancel routine is as follows:
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>_IRQL_requires_max_(DISPATCH_LEVEL)
typedef
VOID
(*PFNKSCANCELPINNEDMDL)(
    _In_ GUID,
    _In_ PVOID,
    _In_ PVOID
);</pre>
</td>
</tr>
</table></span></div>

### -param GUID

<dd>
GUID passed in the <b>KsAcquireCachedMdl</b> function by the Avstream miniport driver.

### -param PVOID

<dd>
Cancel context supplied by the Avstream miniport driver in the <b>KsAcquireCachedMdl</b> function call.

### -param PVOID

<dd>
Release context. This is the output of the <b>KsAcquireCachedMdl</b> function.
</dd>
</dl>

### -param CancelContext 

The context passed to the Avstream driver in the cancel routine. This context is used by the Avstream driver to get into the driver context.

### -param *MdlAddr 

Return value: The resultant MDL if KS finds the MDL stored for the sample buffer.

### -param ReleaseContext 

Return value: The context to be stored by Avstream driver. This context should be passed to KS when releasing the MDL acquired by the <b>KsAcquireCachedMdl</b> call.


## -returns
 Returns STATUS_SUCCESS for success conditions.

## -remarks


## -requirements
<table>
<tr>
<th width="30%">
Target platform
</th>
<td width="70%">
<dl>
<dt><a href="http://go.microsoft.com/fwlink/p/?linkid=531356" target="_blank">Universal</a></dt>
</dl>
</td>
</tr>
<tr>
<th width="30%">
Header
</th>
<td width="70%">
<dl>
<dt>Ks.h</dt>
</dl>
</td>
</tr>
<tr>
<th width="30%">
Library
</th>
<td width="70%">
<dl>
<dt>Ks.lib</dt>
</dl>
</td>
</tr>
</table>